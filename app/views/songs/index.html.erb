<h1>Upload a file</h1>
<%= form_tag songs_path, enctype: 'multipart/form-data' do %>
  <%= file_field_tag :file  %>
  <%= submit_tag 'Upload file' %>
<% end %>

<h1>All songs</h1>
<table class="pretty">
  <thead>
    <tr>
      <th></th>
      <th>Title</th>
      <th>Artist</th>
      <th>Album</th>
      <th>Track</th>
      <th>Genre</th>
      <th>Delete</th>
    </tr>
  </thead>

  <tbody>
  <% @songs.each_with_index do |song,i| %>
    <tr>
      <td><%= i+1 %></td>
      <td><%= link_to song.title, song.s3_url, :class => "song-link", :data => {index: i} %></td>
      <td><%= song.artist %></td>
      <td><%= song.album %></td>
      <td><%= song.track %></td>
      <td><%= song.genre %></td>
      <td><%= button_to "Delete", song, method: :delete, form_class: "logout" %></td>
    </tr>
  <% end %>
  </tbody>
</table>


<script>
$(document).ready(function() {
    controller = new Controller();
    controller.init();

    $('a.song-link').click(function() {

      var currentSong = $(this);
      var url = currentSong.attr('href');
      var index = currentSong.attr('data-index');

      controller.addAudioSrc(url);

      $('audio').on('ended', function(){
        console.log("made it into audio ended")
        $("a[data-index="+(parseInt(index)+1)+"]").click();
        $("audio").trigger("play");
      })

      return false;
    });

    $('a.song-link').first().click();

});
</script>
