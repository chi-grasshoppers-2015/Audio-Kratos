<h3><%= @event.name %></h3>

<% if @open_playlists.any? %>
  <h4>Add your playlist to the event:</h4>
  <%= form_for [@event, @playlistevent] do |f| %>

    <%= f.select(:playlist_id) do %>
      <% @open_playlists.each do |playlist| -%>
        <%= content_tag(:option, playlist.name, value: playlist.id) %>
      <% end %>
    <% end %>

    <%= f.submit "Add playlist" %>
  <% end %>
<% end %>


<h5>Contributions:</h5>
<ul>
  <% @event_playlists.each do |playlist| %>
    <li>- <%= playlist.name %> playlist, added by <%= playlist.owner %> </li>
  <% end %>
</ul>

<ul>
<% @songs.each do |song| %>
  <li><%= song.title %></li>
<% end %>
</ul>



<div class="player">
  <div class="viewer">
  </div>

  <div class="current-data">
    <img class="current-art" src="">
    <div class="current-content">
      <span class="current-title"></span><br>
      <span class="current-artist"></span><br>
      <span class="current-album"></span><br>
    </div>
    <div class="control-panel">
      <div class="more-controls">
        <a href="" ><i class="fa fa-backward"></i></a>
        <a href="" ><i class="fa fa-forward"></i></a>
      </div>
      <div class="controls">
        <audio controls="controls"></audio>
      </div>
    </div>
  </div>
</div>



 <div class="col-md-12 mt">
    <div class="content-panel">
      <table class="table table-hover playlist-table">
        <h4><%= @event.name.upcase %> PLAYLIST</h4>
          <hr>
            <thead>
              <tr>
                <th></th>
                <th></th>
                <th>Vote Count</th>
                <th>Song</th>
                <th>Artist</th>
                <th>Album</th>
                <th>Track</th>
                <th>Genre</th>
              </tr>
            </thead>
            <tbody>
               <% @songs.each_with_index do |song,i| %>
                <tr>
                  <td>
                      <%= form_for @vote, :html => {:class => "vote-form", :method => "POST"} do |f| %>
                        <%= f.hidden_field :song_id, :value => song.id %>
                        <%= f.hidden_field :user_id, :value => session[:user_id] %>
                        <%= f.hidden_field :event_id, :value => params[:id] %>
                        <%= f.hidden_field :value, :value => 1 %>
                        <%= button_tag(type: 'submit', class: "vote-button") do %>
                            <i class="fa fa-caret-up fa-2x"></i>
                        <% end %>
                      <% end %>
                  </td>
                  <td>
                      <%= form_for @vote, :html => {:class => "vote-form", :method => "POST"} do |f| %>
                        <%= f.hidden_field :song_id, :value => song.id %>
                        <%= f.hidden_field :user_id, :value => session[:user_id] %>
                        <%= f.hidden_field :event_id, :value => params[:id] %>
                        <%= f.hidden_field :value, :value => -1 %>
                        <%= button_tag(type: 'submit', class: "vote-button") do %>
                            <i class="fa fa-caret-down fa-2x"></i>
                        <% end %>
                      <% end %>
                  </td>
                  <td>
                      <%= song.net_votes %>
                  </td>
                  <td class="title"><%= link_to song.title ||= "untitled", song.s3_url, :class => "song-link", :data => {index: i} %></td>
                  <td class="artist"><%= song.artist %></td>
                  <td class="album"><%= song.album %></td>
                  <td class="track"><%= song.track %></td>
                  <td class="genre"><%= song.genre %></td>
                </tr>
              <% end %>
            </tbody>
    </table>
  </div>
</div>


<script>
  $(document).ready(function() {
    var controller = new Controller();
    controller.init();

    var songs = <%= @songs.to_json({}).html_safe %>

    controller.loadSongs(songs);

    $('a.song-link').first().click();
    $("audio").trigger("pause");

    var playlistsController = new PlaylistsController(controller.playlist, controller.playlistView);
    playlistsController.init();
  });
</script>
